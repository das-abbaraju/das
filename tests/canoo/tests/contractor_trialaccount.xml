<?xml version="1.0"?>
<!DOCTYPE project SYSTEM "../dtd/Project.dtd">

<project name="PICS" default="test">
	<property name="register.username" value="canoo_contractor1" />
	<property name="admin.username" value="jfazeli" />
	<target name="test">
		<webtest name="Contractor Bid Only Registration - Pre Cleanup">
			&config;
			<steps>
				<storeProperty description="Delete Account" 
					name="login.username" 
					propertyType="ant"
					value="${admin.username}"/>
				&login;
				<setInputField name="filter.accountName" value="Canoo's Test - Bid Only Account"/>
				<clickButton label="Search"/>
				<ifStep description="If canoo present, delete acct">
					<condition>
						<verifyText text="No results found"/>
					</condition>
						<then>
							<clickLink href="Login.action?button=logout"/>
						</then>
						<else>
							&delete_bidcontractor;
						</else>
				</ifStep>
			</steps>
		</webtest>
		<webtest name="Contractor Registration for Bid Only - Register">
			&config;
			<steps>
				<invoke url="Login.action" />
				<clickLink label="Click to Register your company" />

				&body_verify;
				<group description="Register and Save">
									<!-- Register Correctly -->
									<invoke url="ContractorRegistration.action"/>
									<sleep seconds="2"/>
									
									<group description="Company Details">
										<setInputField name="contractor.name" value="Canoo's Test - Bid Only Account"/>
										<setInputField name="contractor.dbaName" value="Canoo's DBA"/>
										<setSelectField name="contractor.country.isoCode" text="United States"/>
										<setInputField name="contractor.taxId" value="789446179"/>
										<setInputField name="contractor.webUrl" value="new.picsorganizer.com/canoo"/>
										<setInputField name="contractor.phone" value="949-123-4567"/>
										<setInputField name="contractor.fax" value="949-123-4568"/>
										<sleep seconds="2"/>
									</group>
										<group description="Primary Address">
										<setInputField name="contractor.address" value="123 Main Street"/>
										<setInputField name="contractor.city" value="Tester"/>
										<setSelectField name="contractor.state.isoCode" text="Kansas"/>
										<setInputField name="contractor.zip" value="54321"/>
									</group>
									<group description="Industry Details">	
										<setSelectField name="contractor.industry" text="Power"/>
										<setSelectField name="contractor.mainTrade" text="Boiler Repair"/>
									</group>
									<group description="Company Identification">
										<setInputField name="contractor.description" 
													   value="This tests the typical registration for a contractor who is 
															  registering for multiple facilities. This is a test account from Canoo webtest. Please delete me."/>
									</group>
									<group description="Primary Contact">
										<setInputField name="user.name" value="John Doe"/>
										<setInputField name="user.email" value="tester@picsauditing.com"/>
										<setInputField name="user.phone" value="1800506PICS"/>
										<setInputField name="user.fax" value="18005061111"/>
										<setInputField name="user.username" value="canoo_bidaccount"/>
										<setInputField description="${login.password}" name="password" value="${login.password}"/>
										<setInputField description="${login.password}" name="confirmPassword" value="${login.password}"/>
									</group>
									
									<clickButton label="Create Account"/>
									<not>
										<verifyText description="search for already exists" text="(?i:already exists)" regex="true" />
									</not>
									&body_verify;
								</group>
				<group description="Services Performed">
					<setRadioButton description="Works with heavy machinery" htmlId="answer2442Yes"/>
					<sleep seconds="2"/>
					<setRadioButton description="Office Setting" htmlId="answer2443Yes"/>
					<sleep seconds="2"/>
					<setRadioButton description="Heights greater than 6ft" htmlId="answer2445Yes"/>
					<sleep seconds="2"/>
					<setRadioButton description="Suggested Risk" htmlId="answer2444Low"/>
					<sleep seconds="2"/>
					<setCheckbox description="Boiler Code" htmlId="answer465_C"/>
					<sleep seconds="2"/>
					<setCheckbox description="Cleaning (Janitorial)" htmlId="answer478_C"/>
					<sleep seconds="2"/>
					<clickLink htmlId="next_link"/>
				</group>
				<group description="Add Facilities">
					<sleep seconds="5"/>
					<clickLink description="Click link: Add" htmlId="facility_6166"/>
					<sleep seconds="5"/>
					<clickLink description="Switch To Bid Only Account" htmlId="bidonly"/>
					<sleep seconds="3"/>
					<clickLink htmlId="next_link"/>
				</group>
				<group description="Add Payment Options">
					<verifyText description="Verify that text is contained in the page" text="$25.00"/>
				</group>
				<group description="Set payment to check, switch back">
					<clickLink href="Login.action?button=logout"/>
					<setInputField name="username" value="opman"/>
					<setInputField name="password" value="${login.password}"/>
					<clickButton label="Login"/>
					<setInputField name="filter.accountName" value="Canoo's Test - Bid Only Account"/>
					<clickButton label="Search"/>
					<verifyText description="Verify that text is contained in the page" text="This is a BID-ONLY Account and will expire on"/>
					<clickLink description="Click link: Payment Options" href="PaymentOptions.action"/>
					<clickButton label="Change Payment Method to Check"/>
					<clickLink description="Click link: Edit Account" href="ContractorEdit.action"/>
					<clickLink href="UsersManage.action"/>
					<clickLink label="John Doe"/>
					<clickLink label="Switch to this User"/>
				</group>
				<group description="Complete Registration">
					<clickLink description="Click link: 5) Confirm" htmlId="conConfirmLink"/>
					<verifyText description="Verify that text is contained in the page" text="$25.00 USD"/>
					<clickButton label="Complete My Registration" name="button"/>
					<verifyText description="Verify that text is contained in the page" text="Your account has been registered successfully."/>
					<clickLink href="Login.action?button=logout"/>
				</group>
			</steps>
			</webtest>
			<webtest name="Trial Account Audits">

			&config;
			<steps>
				<invoke url="Login.action" />
				<group description="Login as Admin, process check">
					<setInputField name="username" value="jfazeli"/>
					<setInputField name="password" value="${login.password}"/>
					<clickButton label="Login"/>
					<ifStep>
						<condition>
							<setInputField name="filter.accountName" value="Canoo's Test - Bid Only Account"/>
							<clickButton label="Search"/>
							<verifyText text="No results found "/>
						</condition>
						<then></then>
						<else>	
							<clickLink description="Click link: Billing Page" href="BillingDetail.action"/>
							<verifyText description="Verify that text is contained in the page" text="25.00 USD"/>
							<clickLink href="InvoiceDetail.action"/>
							<verifyText description="Verify that text is contained in the page" text="Bid Only Account Fee"/>
							<verifyText description="Verify that text is contained in the page" text="25.00 USD"/>
							<clickLink description="Click link: Billing Page" href="BillingDetail.action"/>
							<clickLink label="Make a Payment"/>
							<clickButton label="Apply All"/>
							<clickButton label="Collect Payment"/>
						</else>	
					</ifStep>		
				</group>
				<group description="System Edit">
					<ifStep>
						<condition>
							<setInputField name="filter.accountName" value="Canoo's Test - Bid Only Account"/>
							<clickButton label="Search"/>
							<verifyText text="No results found"/>
						</condition>
						<then></then>
						<else>	
							<clickLink htmlId="pre-qualification"/>
							<clickLink href="ConAuditMaintain.action"/>
							<setSelectField name="conAudit.auditStatus" text="Submitted"/>
							<setInputField htmlId="ConAuditMaintain_conAudit_percentComplete" value="100"/>
							<clickButton label="Save" name="button"/>
							<clickLink htmlId="2007_update"/>
							<clickLink href="ConAuditMaintain.action"/>
							<setSelectField name="conAudit.auditStatus" text="Submitted"/>
							<setInputField htmlId="ConAuditMaintain_conAudit_percentComplete" value="100"/>
							<clickButton label="Save"/>
							<clickLink htmlId="2008_update"/>
							<clickLink href="ConAuditMaintain.action"/>
							<setSelectField name="conAudit.auditStatus" text="Submitted"/>
							<setInputField htmlId="ConAuditMaintain_conAudit_percentComplete" value="100"/>
							<clickButton label="Save" name="button"/>
							<clickLink htmlId="2009_update"/>
							<clickLink href="ConAuditMaintain.action"/>
							<setSelectField name="conAudit.auditStatus" text="Submitted"/>
							<setInputField htmlId="ConAuditMaintain_conAudit_percentComplete" value="100"/>
							<clickButton label="Save"/>
						</else>
					</ifStep>		
				</group>
				<group description="Switch to Contractor">
					<clickLink href="UsersManage.action"/>
					<clickLink label="John Doe"/>
					<clickLink label="Switch to this User"/>	
				</group>
				<group description="Verify Tasks, PQF Categories">
					<sleep seconds="3"/>
					<clickLink htmlId="pre-qualification"/>
					<verifyText description="Verify that text is contained in the page" text="COMPANY INFORMATION"/>
					<verifyText description="Verify that text is contained in the page" text="GENERAL SAFETY INFORMATION"/>
					<verifyText description="Verify that text is contained in the page" text="SERVICES PERFORMED"/>
				</group>
				<group description="Verify Flag Page">
					<clickLink href="ContractorFacilities.action"/>
					<clickLink label="AES Alamitos"/>
				</group>	
			</steps>
		</webtest>
	</target>
</project>

